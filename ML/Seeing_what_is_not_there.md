# 基于上下文环境断定目标缺失 Seeing What Is Not There: Learning Context to Determine Where Objects Are Missing

## 1 摘要及简介

计算机视觉研究大多关注的是图像中有什么，本文提出并训练了一个独立以目标为中心的周边环境模型来完成相反的工作，即检测图像中缺少什么。
我们的周边环境模型可以检测到应该出现的物体，即使它没有出现。
模型基于卷积神经网络结构。通过一个特殊的训练策略，模型学着忽略目标物体本身儿专注于目标周边的环境。

从计算的角度看，在满足以下情况时，一个目标物体被认为在图像中缺失：

1. 目标检测器检测到不存在
1. 目标物体典型环境预测器表明其有很大概率存在

我们需要把所有这样的区域高效地检测出来。目标物体与环境的关系见下表：

| 目标检测器评分 | 环境预测器评分 | 图像区域标记 |
| :------: | :------: | :------: |
| 高 | 高 | 典型物体 |
| 低 | 高 | 物体缺失（该有却没有） |
| 高 | 低 | 不符合环境预期而出现的物体（不该有却有） |

提出这个课题的最初契机是街景路缘坡道（路口马路牙子便于残疾人上下的斜坡）检测问题。
标记城市路口路缘坡道的有无以便于残疾人规划其出行路线。

![](.Seeing_what_is_not_there_images\f1.png)

> 图注：当路口路缘坡道缺失（如图中左侧橙色区域，右侧绿色区域为正常）时，行动障碍人士将无法穿越这个路口。
我们提出了一种通过学习周边环境来检测物体缺失的模型，用来与目标检测的结果结合。

解决这个问题的关键在于训练一个仅关注周边环境的模型，就像一个目标检测器一样：通过扫描每张图片，获得一个概率映射热力图，
图中每一个像素代表这一点目标存在的概率，即使目标物体不存在。
这种周边环境和目标分离的好处在于，我们不需要再训练集中标记不正常（缺失、不符合环境预期而出现的物体）的目标物体，
独立周边环境模型可以由典型目标物体训练得到，而后用于寻找不正常目标物体。
这大大减轻了训练的工作量，因为正常物体的样本非常丰富，收集起来比不正常样本容易得多。

本文主要内容

1. 提出一种通过学习遮罩物体来获得以目标为中心的周边环境表示的训练方法。
1. 提出一种通过强制神经网络忽略物体本身，学习非显式遮罩的训练策略。
1. 应用于检测街景图中缺失路缘坡道的较理想结果；应用于检测不符合环境预期出现的人脸图像的初步结果。

## 2 相关工作

### 目标识别中的周边环境

### 找到缺少的目标

### 带有遮罩图像的计算机视觉

### Accessibility Task

## 3 从显式目标遮罩中学习周边环境

这部分介绍前文提到的周边环境学习算法的基本版本。
如果周边环境被定义为目标物体周围除了目标物体本身的内容，那么可以认为这个模型字面上说是在学习周边环境：
因为所有训练集中的目标物体都被遮罩掉了。

在一个图像二分类训练集上训练模型。

1. 正样本：目标物体在每张图中心，物体本身及其视觉延伸被黑框遮罩（预处理后值为零）。整个图片宽约是物体边界框的4倍。
1. 负样本：每张图片中心区域采用类似的遮罩层随机裁剪。被覆盖的区域与ground truth标记物体重合不大于Jaccard系数0.2。

> Jaccard Index : 给定两个集合A,B的Jaccard系数定义为A与B交集的大小与并集大小的比值。

\begin{equation}
J(A,B) = \frac{|A \cap B|}{|A \cup B|} = \frac{|A \cap B|}{|A|+|B|-|A \cap B|}
\end{equation}

> Jaccard值越大说明相似度越高。当A和B相等时，Jaccard(A,B)=1； 

若一幅图像中有多个目标物体，在每个正样本中仅遮罩一个。
因为对于一个目标物体来说，其他目标物体可以视作有用的“周边环境”。
例如，路缘坡道就经常成对出现。

\begin{equation}
L_c = -Q_y(I_m) + log \sum_y e^{Q_y(I_m)}
\end{equation}

## 4 学习隐式遮罩的全卷积模型 A Fully Convolutional Model that Learns Implicit Masks

\begin{equation}
L_d = \| Q_y(I_m) - Q(I) \|_{p}
\end{equation}

![](.Seeing_what_is_not_there_images\F2.png)

孪生训练全卷积周边环境神经网络 the Siamese trained Fully convolutional Context network (SFC)的训练方案图。
直觉上看，强制全卷积神经网络Q输出相似的结果，无论输入图片被遮罩与否。

> Siamese network 孪生神经网络，简单来说用于衡量两个输入的相似程度。孪生神经网络有两个输入（Input1 and Input2）,将两个输入feed进入两个神经网络（Network1 and Network2），这两个神经网络分别将输入映射到新的空间，形成输入在新的空间中的表示。通过Loss的计算，评价两个输入的相似度。


\begin{equation}
L = \lambda L_d + L_c 
\end{equation}

![](.Seeing_what_is_not_there_images\f3.png)

上：输入：街景全景图。

中：使用基本神经网络利用滑动窗口方法生成的热力图。由于较高的计算损失，空间分辨率低。

下：利用SFC生成的稠密热力图。

hard negative mining（难分样本挖掘）：把错误（尤其是顽固棘手的）送回训练集作为负样本，继续训练。

## 5 找到缺失物体区域的渠道 Finding Missing Object Regions Pipeline

利用独立的周边环境网络（基本网络或SFC网络），找出缺失物体区域的步骤如下：

1. 通过周边环境网络Q生成环境热力图。热力图表示目标物体应该出现的位置。
1. 利用目标检测器生成目标检测结果。将目标检测结果转换为二值图像（0-1图像），转换方式为，
目标物体边界框以内均转为0，其它区域为1。
1. 将热力图与二值图执行按像素与操作，得到结果图，是目标物体应该出现但目标检测器未检测到物体的区域。
1. 根据结果图，取其高分区域（超过某一阈值），将原图中对应部分裁剪下来，得到物体缺失区域。

## 6 实验

### 6.1. Characteristics of the Trained Model

### 6.2. Finding Missing Curb Ramp Regions

### 6.3. Finding Out of Context Faces

## 7 结论

